USE [TN_CSDLPT]
GO
/****** Object:  StoredProcedure [dbo].[SP_DANGNHAP]    Script Date: 12/23/2019 10:19:07 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_DANGNHAP] @TENLOGIN NVARCHAR (50)
AS
DECLARE @TENUSER NVARCHAR(50),
		@HOTEN NVARCHAR(50),
		@TENNHOM nVARCHAR(50),
		@LOAI NVARCHAR(20),

		@MALOP NCHAR(8),
		@TENLOP NVARCHAR(50)
-- GET USER ID
SELECT @TENUSER = NAME FROM sys.sysusers WHERE sid = SUSER_SID(@TENLOGIN)
-- MAKE SURE USER_ID NOT NULL
if (@TENUSER IS NOT NULL) 
BEGIN


-- GET HO_TEN USER from Table Giao Vien 
SELECT @HOTEN   = HO + ' '+ TEN FROM GIAOVIEN  WHERE MAGV = @TENUSER
SET @LOAI = 'giangvien'
-- MAKE SURE HOTEN IS NOT NULL
if (@HOTEN IS NULL)
	BEGIN 
		-- GET HO TEN FROM TABLE SINHVIEN
		SELECT TOP 1 @HOTEN   = HO + ' '+ TEN, @MALOP = MALOP FROM SINHVIEN  WHERE MASV = @TENUSER
		SELECT TOP 1 @TENLOP = TENLOP from LOP where MALOP = @MALOP
		SET @LOAI = 'sinhvien'


	END

-- GET TEN NHOM, THEN RETURN result
 SELECT USERNAME = @TENUSER, 
	    HOTEN = @HOTEN,
	    TENNHOM = NAME,
		LOAI = @LOAI,
		MALOP = @MALOP,
		TENLOP = @TENLOP
        FROM sys.sysusers 
        WHERE UID = (SELECT GROUPUID 
                 FROM SYS.SYSMEMBERS 
                   WHERE MEMBERUID= (SELECT UID FROM sys.sysusers 
                                      WHERE NAME = @TENUSER))
END

